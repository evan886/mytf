éå¸¸å¥½ ğŸ‘
ä½ æ˜¯ **Infra å·¥ç¨‹å¸ˆ**ï¼Œå…¬å¸å·²ç»æœ‰ Terraform é¡¹ç›®ç”¨äºç®¡ç† **AWS åŸºç¡€è®¾æ–½**ï¼Œä½ è¦çš„æ˜¯ä¸€ä¸ª**å¿«é€Ÿå…¥é—¨ + å®æˆ˜å¯¼å‘**çš„æ•™ç¨‹ï¼Œè®©ä½ èƒ½é©¬ä¸Šçœ‹æ‡‚åˆ«äººå†™çš„ Terraform ä»£ç ï¼Œå¹¶è‡ªå·±æ”¹ã€è·‘ã€è°ƒã€‚

æˆ‘ä»¬æ¥ä¸€æ­¥æ­¥ææ¸…æ¥š Terraform çš„æ ¸å¿ƒæ¦‚å¿µã€å‘½ä»¤æµç¨‹å’ŒAWSå®æˆ˜ï¼ˆèŠ± 30â€“60 åˆ†é’Ÿææ˜ç™½ï¼‰ã€‚

---

## ğŸš© ä¸€ã€Terraform æ˜¯ä»€ä¹ˆ

Terraform æ˜¯ä¸€ç§ **åŸºç¡€è®¾æ–½å³ä»£ç ï¼ˆInfrastructure as Code, IaCï¼‰** å·¥å…·ï¼Œç”¨æ¥**å®šä¹‰ã€åˆ›å»ºå’Œç®¡ç†äº‘èµ„æºï¼ˆAWSã€Azureã€GCPã€K8sç­‰ï¼‰**ã€‚

ä½ å†™çš„ `.tf` æ–‡ä»¶å®šä¹‰äº†ä½ è¦çš„åŸºç¡€è®¾æ–½ï¼ŒTerraform é€šè¿‡ `terraform apply` è‡ªåŠ¨åˆ›å»ºã€ä¿®æ”¹æˆ–é”€æ¯è¿™äº›èµ„æºã€‚

ğŸ‘‰ å°±åƒ **ç”¨ä»£ç ç®¡ç† AWS Console ä¸Šçš„æ‰€æœ‰æ“ä½œ**ã€‚

---

## ğŸš© äºŒã€æ ¸å¿ƒæ¦‚å¿µï¼ˆéå¸¸å…³é”®ï¼‰

| æ¦‚å¿µ              | å«ä¹‰                  | AWS å¯¹åº”              |
| --------------- | ------------------- | ------------------- |
| **Provider**    | å‘Šè¯‰ Terraform è¦æ“ä½œå“ªä¸ªäº‘ | ä¾‹å¦‚ `aws`            |
| **Resource**    | ä½ è¦åˆ›å»ºçš„èµ„æº             | EC2, S3, IAM Role   |
| **Data Source** | è¯»å–å·²æœ‰èµ„æºçš„æ•°æ®           | ä¾‹å¦‚å·²æœ‰çš„ VPC           |
| **Variable**    | å˜é‡ï¼Œæ–¹ä¾¿å¤ç”¨             | `${var.region}`     |
| **Output**      | è¾“å‡ºå€¼                 | æ¯”å¦‚æ‰“å°å‡ºEC2 IP         |
| **State æ–‡ä»¶**    | ä¿å­˜å½“å‰èµ„æºçŠ¶æ€            | `terraform.tfstate` |
| **Module**      | æ¨¡å—åŒ–ç®¡ç†èµ„æº             | â€œå¯é‡ç”¨æ¨¡æ¿â€             |

---

## ğŸš© ä¸‰ã€æœ€å°å¯è¿è¡Œä¾‹å­ï¼ˆAWS å®æˆ˜ï¼‰

å‡è®¾ä½ è¦åœ¨ AWS åˆ›å»ºä¸€ä¸ª EC2 å®ä¾‹ï¼š

```bash
mkdir tf-demo && cd tf-demo
```

**æ–‡ä»¶ï¼šmain.tf**

```hcl
provider "aws" {
  region = "ap-southeast-1" # æ–°åŠ å¡åŒºåŸŸ
}

resource "aws_instance" "demo" {
  ami           = "ami-0c55b159cbfafe1f0" # Amazon Linux 2
  instance_type = "t3.micro"

  tags = {
    Name = "terraform-demo"
  }
}
```

---

## ğŸš© å››ã€Terraform å‘½ä»¤æ ¸å¿ƒæµç¨‹ï¼ˆè®°ä½è¿™äº”ä¸ªï¼‰

| å‘½ä»¤                  | ä½œç”¨                |
| ------------------- | ----------------- |
| `terraform init`    | åˆå§‹åŒ–é¡¹ç›®ï¼Œä¸‹è½½ provider |
| `terraform plan`    | é¢„è§ˆæ‰§è¡Œè®¡åˆ’ï¼ˆä¸ä¼šçœŸæ­£åˆ›å»ºèµ„æºï¼‰  |
| `terraform apply`   | æ‰§è¡Œåˆ›å»ºèµ„æº            |
| `terraform show`    | æŸ¥çœ‹å½“å‰èµ„æºçŠ¶æ€          |
| `terraform destroy` | é”€æ¯èµ„æº              |

ğŸ‘£ å®æˆ˜æ¼”ç»ƒï¼š

```bash
terraform init
terraform plan
terraform apply -auto-approve
terraform show
terraform destroy -auto-approve
```

æ‰§è¡Œå®Œåï¼Œä½ å¯ä»¥ç™»å½• AWS æ§åˆ¶å° â†’ EC2 â†’ çœ‹åˆ°å®ä¾‹è¢«åˆ›å»º & åˆ é™¤ã€‚

---

## ğŸš© äº”ã€å˜é‡ä¸æ¨¡å—åŒ–ï¼ˆçœ‹æ‡‚å…¬å¸é¡¹ç›®çš„å…³é”®ï¼‰

å…¬å¸ Terraform é¡¹ç›®ä¸€èˆ¬ä¸ä¼šæŠŠæ‰€æœ‰èµ„æºéƒ½å†™åœ¨ `main.tf`ï¼Œè€Œæ˜¯æ‹†æˆæ¨¡å—ã€‚

### 1ï¸âƒ£ å˜é‡å®šä¹‰

`variables.tf`

```hcl
variable "region" {
  default = "ap-southeast-1"
}
variable "instance_type" {
  default = "t3.micro"
}
```

### 2ï¸âƒ£ è°ƒç”¨å˜é‡

`main.tf`

```hcl
provider "aws" {
  region = var.region
}

resource "aws_instance" "demo" {
  ami           = "ami-01c94064639c71719"
  instance_type = var.instance_type
}
```

### 3ï¸âƒ£ æ¨¡å—ç»“æ„ï¼ˆä½ åœ¨å…¬å¸çœ‹åˆ°çš„å¯èƒ½é•¿è¿™æ ·ï¼‰

```
terraform/
â”œâ”€â”€ main.tf
â”œâ”€â”€ variables.tf
â”œâ”€â”€ outputs.tf
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ vpc/
â”‚   â”œâ”€â”€ ec2/
â”‚   â””â”€â”€ rds/
â””â”€â”€ environments/
    â”œâ”€â”€ dev/
    â””â”€â”€ prod/
```

ä¸»é¡¹ç›®é€šè¿‡ `module` å¼•ç”¨ï¼š

```hcl
module "vpc" {
  source = "./modules/vpc"
  cidr_block = "10.0.0.0/16"
}
```

æ¨¡å—å†…éƒ¨å†å®šä¹‰å¤šä¸ªèµ„æºï¼Œæ¯”å¦‚å­ç½‘ã€ç½‘å…³ã€è·¯ç”±è¡¨ç­‰ã€‚

---

## ğŸš© å…­ã€State æ–‡ä»¶ä¸è¿œç¨‹ç®¡ç†

Terraform çš„â€œè®°å¿†â€åœ¨ `.tfstate` æ–‡ä»¶é‡Œã€‚

* æœ¬åœ°è¿è¡Œï¼š`terraform.tfstate` åœ¨æœ¬åœ°ç›®å½•ã€‚
* å…¬å¸é¡¹ç›®ï¼šä¸€èˆ¬é…ç½®åœ¨ **è¿œç¨‹ backend**ï¼Œä¾‹å¦‚ AWS S3 + DynamoDBï¼Œç”¨äºå¤šäººåä½œã€‚

ä¾‹å­ï¼š

```hcl
terraform {
  backend "s3" {
    bucket = "company-terraform-state"
    key    = "prod/network.tfstate"
    region = "ap-southeast-1"
  }
}
```

---

## ğŸš© ä¸ƒã€çœ‹æ‡‚å…¬å¸ Terraform é¡¹ç›®çš„æŠ€å·§

1. å…ˆæ‰“å¼€ `main.tf` â†’ çœ‹å“ªäº› **module** è¢«å¼•ç”¨ã€‚
2. æ‰“å¼€ `terraform.tfvars` â†’ çœ‹éƒ¨ç½²æ—¶ä½¿ç”¨çš„å˜é‡å€¼ã€‚
3. æœç´¢ `provider "aws"` â†’ çœ‹æ˜¯å“ªä¸ª regionã€‚
4. æ‰§è¡Œ `terraform plan` â†’ æ¨¡æ‹Ÿçœ‹çœ‹å®ƒä¼šåˆ›å»º/ä¿®æ”¹å“ªäº›èµ„æºã€‚
5. å¦‚æœç”¨äº† **workspace**ï¼ˆå¤šç¯å¢ƒï¼‰ï¼Œç”¨ï¼š

   ```bash
   terraform workspace list
   terraform workspace select dev
   ```

   ä¸åŒ workspace ä¼šå¯¹åº”ä¸åŒ tfstateï¼ˆä¾‹å¦‚ dev/prodï¼‰ã€‚

---

## ğŸš© å…«ã€å¸¸è§å‘ï¼ˆæå‰é¿é›·ï¼‰

| é—®é¢˜                           | åŸå›                                    |
| ---------------------------- | ------------------------------------ |
| `Error acquiring state lock` | è¿œç¨‹ state è¢«åˆ«äººå ç”¨ï¼ˆç­‰ä¸€ä¼šæˆ–æ‰‹åŠ¨è§£é”ï¼‰             |
| ä¿®æ”¹æ‰‹å·¥ AWS èµ„æºåï¼ŒTerraform ä¸çŸ¥é“   | å› ä¸º state é‡Œæ²¡æœ‰æ›´æ–°ï¼Œè¦ç”¨ `terraform import` |
| ä¸å°å¿ƒåˆ é™¤ .tfstate               | ä¼šå¤±è”èµ„æºï¼Œè¦é‡æ–° import                     |
| region å†™é”™ï¼Œèµ„æºåˆ›å»ºåˆ°é”™è¯¯åŒºåŸŸ          | provider é…ç½®é—®é¢˜                        |

---

## ğŸš© ä¹ã€ç»ƒæ‰‹å»ºè®®ï¼ˆ1å°æ—¶å¿«é€Ÿå…¥é—¨è·¯çº¿ï¼‰

| æ—¶é—´       | å†…å®¹                                 |
| -------- | ---------------------------------- |
| 0-15 åˆ†é’Ÿ  | è·‘ä¸Šé¢ EC2 Demo                       |
| 15-30 åˆ†é’Ÿ | æ”¹æˆä½¿ç”¨å˜é‡                             |
| 30-45 åˆ†é’Ÿ | å¢åŠ ä¸€ä¸ª S3 bucket                     |
| 45-60 åˆ†é’Ÿ | çœ‹å…¬å¸é¡¹ç›®ç›®å½•ç»“æ„ï¼Œæ‰§è¡Œ `terraform plan` è§‚å¯Ÿå˜åŒ– |

---

## ğŸš© åã€ä½ èƒ½å¿«é€Ÿä¸Šæ‰‹çš„å…³é”®ç›®æ ‡

âœ… çœ‹æ‡‚æ¨¡å—åŒ–ç»“æ„ï¼ˆmodule æ¦‚å¿µï¼‰
âœ… ä¼šè·‘ init â†’ plan â†’ apply â†’ destroy
âœ… èƒ½æ”¹å˜é‡ã€æŸ¥çœ‹ state
âœ… æ˜ç™½ backend åœ¨ç®¡ç† state
âœ… èƒ½çœ‹æ‡‚åˆ«äººå†™çš„ resource å®šä¹‰

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ï¼š

* ğŸ”¹ å¸®ä½ å¿«é€Ÿè§£æå…¬å¸ Terraform é¡¹ç›®çš„ç›®å½•ç»“æ„ï¼ˆä½ è´´ä¸€æ®µç›®å½•ï¼‰
* ğŸ”¹ æˆ–è€…å¸®ä½ å†™ä¸€ä¸ª**å…¬å¸çº§ AWS Terraform æ¨¡æ¿ï¼ˆå«S3ã€EC2ã€VPCã€IAMï¼‰**çš„å…¥é—¨ç‰ˆ

ä½ æƒ³æˆ‘å¸®ä½ å“ªä¸€ä¸ªï¼Ÿï¼ˆè§£æç°æœ‰é¡¹ç›®ç»“æ„ vs ä»é›¶å†™ä¸€ä¸ªå…¬å¸é£æ ¼çš„ AWS Terraform æ¨¡æ¿ï¼‰

